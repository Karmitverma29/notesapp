<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   <link rel="stylesheet" href="./createnotes.css">
</head>
<body>
    <div id="container">

        <h1>Notes</h1>
        <input id="title" type="text" placeholder="Title">
        <input id="body" type="text" placeholder="Write your note here">
        <button onclick="add()">Add</button>
    </div>
    <div id="notes">

    </div>
</body>
</html>

<script>
    

const add=()=>{
    let title=document.getElementById("title").value;
    let body=document.getElementById("body").value;
let notesdata={
title,
body
}

    fetch('http://localhost:8080/notes/create',{
    method:'POST',
    headers:{
        "Content-type":"application/json",
        "Authorization":localStorage.getItem("token")
    },
    body:JSON.stringify(notesdata)
}).then((res)=>res.json (notesdata))
.then((res)=>{
    console.log(res);
    location.reload();

})
.catch((err)=>console.log(err))



}

fetch('http://localhost:8080/notes',{
    method:'GET',
    headers:{
        "Authorization":localStorage.getItem("token")
    },
}).then((res)=>res.json())
.then((res)=>{
    console.log(res)
    appendData(res);
})
.catch((err)=>console.log(err))

const appendData=(data)=>{

data.forEach((el)=>{

    let contain=document.getElementById("notes");
    let div=document.createElement("div");
    let title=document.createElement("h2");
    let body=document.createElement("p");
    let deletebtn=document.createElement("button");
    deletebtn.innerText="Delete note";
    let updatebtn=document.createElement("button");
    updatebtn.innerText="Update note";
    div.className = "note";
    title.className = "note-title";
    body.className = "note-body";
    deletebtn.className = "note-delete";
    updatebtn.className = "note-update";

    title.innerText=el.title;
    body.innerText=el.body;
    deletebtn.addEventListener("click",()=>{
  fetch(`http://localhost:8080/notes/delete/${el._id}`,{
    method:'DELETE',
    headers:{
        "Authorization":localStorage.getItem("token")

    }
  }).then((res)=>res.json())
    .then((res)=>{
      console.log(res);
      location.reload();
    })
    .catch((err)=>console.log(err))
})
updatebtn.addEventListener("click",()=>{
    let title = el.title;
    let body = el.body;
    let updatedTitle = prompt("Enter updated title", title);
    let updatedBody = prompt("Enter updated body", body);
    let notesdata={
        title: updatedTitle || title,
        body: updatedBody || body
    }

    fetch(`http://localhost:8080/notes/update/${el._id}`,{
        method:'PATCH',
        headers:{
            "Content-type":"application/json",
            "Authorization":localStorage.getItem("token")
        },
        body:JSON.stringify(notesdata)
    }).then((res)=>res.json())
    .then((res)=>{
        console.log(res);
        location.reload();
    })
    .catch((err)=>console.log(err))
})

    div.append(title,body,deletebtn,updatebtn);
    contain.append(div);


})
}

</script>